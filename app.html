let currentUser = JSON.parse(localStorage.getItem('currentUser'));
if (!currentUser) { window.location.href = 'index.html'; }

const UI = {
    toggleDrawer() {
        document.getElementById('drawer').classList.toggle('open');
        document.getElementById('drawerOverlay').classList.toggle('open');
    },
    closeDrawer() {
        document.getElementById('drawer').classList.remove('open');
        document.getElementById('drawerOverlay').classList.remove('open');
    },
    toggleSearch() {
        document.getElementById('searchBar').classList.toggle('show');
    },
    openCreateModal() { document.getElementById('createModal').classList.add('open'); },
    closeCreateModal() { document.getElementById('createModal').classList.remove('open'); },
    openCountersMenu() { document.getElementById('countersMenu').classList.add('open'); },
    closeCountersMenu() { document.getElementById('countersMenu').classList.remove('open'); },
    countersAction(action) { alert('قيد التطوير: ' + action); this.closeCountersMenu(); },
    showSettings(type) { if (type === 'counters') this.openCountersMenu(); else alert(type); this.closeDrawer(); },
    updateDrawerInfo() { /* مؤقتاً */ },
    changePhoto() { alert('تغيير الصورة'); },
    editName() { alert('تعديل الاسم'); this.closeDrawer(); },
    editUsername() { alert('تعديل اسم المستخدم'); this.closeDrawer(); },
    toggleDarkMode() { document.body.classList.toggle('dark-mode'); this.closeDrawer(); },
    closeProfile() { document.getElementById('profileModal').classList.remove('open'); },
    closeForwardModal() { document.getElementById('forwardModal').classList.remove('open'); },
    openProfileFromChat() {}
};

const Auth = { logout() { localStorage.removeItem('currentUser'); window.location.href = 'index.html'; } };
const Search = { handle() { alert('بحث'); } };
const GroupsAndChannels = { create() { alert('إنشاء'); UI.closeCreateModal(); } };
const Chat = { close() { document.getElementById('chatRoom').classList.remove('open'); }, sendMessage() {} };
const Support = { openSupportPanel() { document.getElementById('supportPanel').classList.add('open'); }, closeSupportPanel() { document.getElementById('supportPanel').classList.remove('open'); } };
const Channel = { open() { alert('قناة المطور'); } };

document.getElementById('searchInput').addEventListener('keyup', Search.handle);
