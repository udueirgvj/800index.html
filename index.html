<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>

<style>
*{box-sizing:border-box;font-family:Tahoma}
body{margin:0;background:linear-gradient(135deg,#0f172a,#020617);color:white}

/* تسجيل */
.container{
max-width:380px;
margin:40px auto;
background:#111827;
padding:20px;
border-radius:15px;
box-shadow:0 0 20px rgba(0,0,0,.5)
}
h2{text-align:center}

input{
width:100%;
padding:12px;
margin:8px 0;
border:none;
border-radius:10px;
background:#1f2937;
color:white
}

button{
width:100%;
padding:12px;
border:none;
border-radius:12px;
background:#22c55e;
color:white;
font-size:16px;
cursor:pointer
}

/* الدردشة */
#chat{display:none;height:100vh}
#messages{height:85vh;overflow-y:auto;padding:10px}
.msg{background:#1e293b;padding:10px;margin:6px 0;border-radius:10px}

form{
display:flex;
position:fixed;
bottom:0;
width:100%
}

form input{flex:1}
form button{width:90px;background:#22c55e}
</style>
</head>

<body>

<!-- تسجيل -->
<div class="container" id="login">
<h2>دخول الدردشة</h2>
<input id="username" placeholder="اكتب اسمك">
<button onclick="enterChat()">دخول</button>
</div>

<!-- الدردشة -->
<div id="chat">
<div id="messages"></div>

<form onsubmit="sendMessage(event)">
<input id="messageInput" placeholder="اكتب رسالة...">
<button>إرسال</button>
</form>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDRCtfuYrEdnuKUsWu_79N0",
  authDomain: "tttrt-b8c5a.firebaseapp.com",
  databaseURL: "https://tttrt-b8c5a-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tttrt-b8c5a",
  storageBucket: "tttrt-b8c5a.appspot.com",
  messagingSenderId: "975123752593",
  appId: "1:975123752593:web:e591e930af101968875560"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let user="";

/* دخول */
function enterChat(){
    user=document.getElementById("username").value;
    if(user=="") return alert("اكتب اسمك");

    document.getElementById("login").style.display="none";
    document.getElementById("chat").style.display="block";

    loadMessages();
}

/* إرسال رسالة */
function sendMessage(e){
    e.preventDefault();
    let input=document.getElementById("messageInput");
    let msg=input.value;
    if(msg=="") return;

    db.ref("messages").push({
        user:user,
        text:msg,
        time:new Date().toLocaleTimeString()
    });

    input.value="";
}

/* استقبال الرسائل */
function loadMessages(){

    const messagesDiv=document.getElementById("messages");
    messagesDiv.innerHTML="";

    db.ref("messages").on("child_added", function(snapshot){
        const m=snapshot.val();

        let div=document.createElement("div");
        div.className="msg";
        div.innerHTML="<b>"+m.user+"</b><br>"+m.text+
        "<br><small style='color:gray'>"+m.time+"</small>";

        messagesDiv.appendChild(div);
        messagesDiv.scrollTop=messagesDiv.scrollHeight;
    });
}
</script>

</body>
</html>
